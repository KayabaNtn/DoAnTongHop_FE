<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Cats Sport AcademyThe Band</title>
    <link href="./assets/css/FE_18_QL.css" rel="stylesheet">
    <link href="./assets/css/responsive.css" rel="stylesheet">
    <link href="./assets/fonts/themify-icons.css" rel="stylesheet">
</head>
<body>

<div id="main">

    <div id="header">
        <!-- Begin : nav -->
        <ul id="nav"> <!--ul#nav>li*5 -->
            <img alt="abc" class="logo" src="./assets/image/logo.jpg">
            <li><a href="#bodys">HOME</a></li>
            <li><a href="./FE_24_QL.html">Sinh Viên </a></li>
            <li><a href="./FE_36_QL.html">Hợp Đồng </a></li>
            <li><a href="./FE_42_QL.html">Phiếu Đăng Kí </a></li>
            <li><a href="./FE_54_QL.html">Feed-Back </a></li>
            <li><a href="./FE_18_QL.html">Khóa Học </a></li>
            <li><a href="./FE_48_QL.html">Vật tư </a></li>
            <li><a href="#footer">Giới thiệu</a></li>
        </ul>
        <!-- End : nav -->
        <!-- Begin : search button -->
        <div class="search-btn">
            <i class="search-icon ti-search"></i>
        </div>
        <div class="search-btn1">
            <p class="fix">Sengphet PHILAVONG <br>
                Quản lí </p>
        </div>
        <!-- End : search button -->
    </div>

    <div id="bodys">
        <div class="form-student">
            <h3>Thông tin khoá học</h3>

            <label>Tên khoá học:</label>
            <input id="KH" tabindex="1" type="text">
            <br>

            <label>Thời gian :</label>
            <input id="Date" tabindex="1" type="text">
            <br>

            <label>Lịch Dạy :</label>
            <input id="LichDay" tabindex="1" type="text">
            <br>

            <label>Giá tiền :</label>
            <input id="GiaTien" tabindex="1" type="text">
            <br>

            <label>&nbsp;</label>
            <button class="btn-save save js-buy-ticket-them">Thêm</button>

            <button class="btn-save Search" onclick="SEARCH()">Tìm Kiếm</button>
            <label>&nbsp;</label>
            <!--            <button class="btn-save js-buy-ticket">-->
            <!--                Sửa-->
            <!--            </button>-->

        </div>

        <div class="list-student">
            <h3>Danh sách khóa học</h3>
            <table id="table-container">
                <thead>
                <tr>
                    <th>STT</th>
                    <th>ID khóa học</th>
                    <th>Tên khóa học</th>
                    <th>Thời gian</th>
                    <th>Lịch dạy</th>
                    <th>Giá tiền</th>
                    <th>Thao tác</th>
                </tr>
                </thead>
                <tbody>
                <!-- Các hàng dữ liệu sẽ được thêm vào đây -->
                </tbody>
            </table>
        </div>
    </div>

    <div id="footer">
        <div class="socials-list">
            <a href=""><i class="ti-facebook"></i></a>
            <a href=""><i class="ti-instagram"></i></a>
            <a href=""><i class="ti-youtube"></i></a>
            <a href=""><i class="ti-twitter"></i></a>
            <a href=""><i class="ti-linkedin"></i></a>
        </div>
        <p class="copyright">
            Powered by <a href="#"> Cats Sport Academy
        </a>
        </p>
    </div>
</div>
<div class="modal js-modal">
    <div class="modal-container js-modal-container">
        <div class="modal-close js-modal-close ">
            <i class="ti-close"></i>
        </div>

        <header class="modal-header">
            <i class="modal-heading-icon ti-bag"></i>
            Sửa Đổi
        </header>

        <div class="modal-body">

            <label class="modal-label" for="updateIdKh">
                <i class="ti-star"></i>
                ID Khóa Học :
            </label>
            <input class="modal-input" disabled id="updateIdKh" placeholder=" ID Khóa Học ?" type="text">

            <label class="modal-label" for="updateTenKh">
                <i class="ti-headphone-alt"></i>
                Tên Khóa học :
            </label>
            <input class="modal-input" id="updateTenKh" placeholder=" Tên khóa học: ?" type="text">

            <label class="modal-label" for="updateThoiGian">
                <i class="ti-home"></i>
                Thời Gian :
            </label>
            <input class="modal-input" id="updateThoiGian" placeholder="Thời gian ?" type="text">

            <label class="modal-label" for="updateLichDay">
                <i class="ti-user"></i>
                Lịch Dạy :
            </label>
            <input class="modal-input" id="updateLichDay" placeholder="Lịch dạy ?" type="text">

            <label class="modal-label" for="updateGiaTien">
                <i class="ti-user"></i>
                Giá tiền :
            </label>
            <input class="modal-input" id="updateGiaTien" placeholder="Giá tiền ?" type="text">

            <button class="buttonEdit" id="buy-tickets" onclick="suaKhoaHoc()">
                Sửa <i class="ti-check"></i>
            </button>

        </div>

        <footer class="modal-footer">
            <p class="modal-help">Need <a href="#">helf?</a></p>
        </footer>
    </div>
</div>

<div class="modal js-modal-them">
    <div class="modal-container js-modal-container-them">
        <div class="modal-close js-modal-close-them ">
            <i class="ti-close"></i>
        </div>

        <header class="modal-header">
            <i class="modal-heading-icon ti-bag"></i>
            Thêm
        </header>

        <div class="modal-body">

            <label class="modal-label" for="modal-tenKh-them">
                <i class="ti-headphone-alt"></i>
                Tên Khóa học :
            </label>
            <input class="modal-input" id="modal-tenKh-them" placeholder=" Tên khóa học ?" type="text">

            <label class="modal-label" for="modal-thoiGian-them">
                <i class="ti-home"></i>
                Thời Gian :
            </label>
            <input class="modal-input" id="modal-thoiGian-them" placeholder="Thời gian ?" type="text">

            <label class="modal-label" for="modal-lichDay-them">
                <i class="ti-user"></i>
                Lịch Dạy :
            </label>
            <input class="modal-input" id="modal-lichDay-them" placeholder=" Lịch dạy ?" type="text">

            <label class="modal-label" for="modal-giaTien-them">
                <i class="ti-user"></i>
                Giá tiền :
            </label>
            <input class="modal-input" id="modal-giaTien-them" placeholder=" Giá tiền ?" type="text">

            <button class="save" class="" id="buy-tickets" onclick="getValue()">
                Thêm <i class="ti-check"></i>
            </button>

        </div>

        <footer class="modal-footer">
            <p class="modal-help">Need <a href="#">helf?</a></p>
        </footer>
    </div>
</div>

<script>
    const Them = document.querySelectorAll('.js-buy-ticket-them')
    const modal1 = document.querySelector('.js-modal-them')
    const modalClose1 = document.querySelector('.js-modal-close-them')
    const modalContainer1 = document.querySelector('.js-modal-container-them')


    function showBuy() {
        modal1.classList.add('open')
    }

    function hideBuy() {
        modal1.classList.remove('open')
    }

    for (const buyBtn of Them) {
        buyBtn.addEventListener('click', showBuy)
    }

    modalClose1.addEventListener('click', hideBuy)

    modal1.addEventListener('click', hideBuy)

    modalContainer1.addEventListener('click', function (event) {
        event.stopPropagation()
    })
</script>


<script>
    const buyBtns = document.querySelectorAll('.js-buy-ticket')
    const modal = document.querySelector('.js-modal')
    const modalClose = document.querySelector('.js-modal-close')
    const modalContainer = document.querySelector('.js-modal-container')


    function showBuy() {
        modal.classList.add('open')
    }

    function hideBuy() {
        modal.classList.remove('open')
    }

    for (const buyBtn of buyBtns) {
        buyBtn.addEventListener('click', showBuy)
    }

    modalClose.addEventListener('click', hideBuy)

    modal.addEventListener('click', hideBuy)

    modalContainer.addEventListener('click', function (event) {
        event.stopPropagation()
    })
</script>

<script>
    const Save = document.querySelector(" .save");


    // Example POST method implementation:
    async function Saves(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "POST", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }


    function getValue() {
        // Lấy tham chiếu đến phần tử input
        var inputName = document.getElementById("modal-tenKh-them").value;
        var inputDate = document.getElementById("modal-thoiGian-them").value;
        var inputLichDay = document.getElementById("modal-lichDay-them").value;
        var inputGiaTien = document.getElementById("modal-giaTien-them").value;


        Save.addEventListener('click', Saves("http://localhost:8889/KhoaHoc/themMoi", {
            tenKh: inputName,
            thoiGian: inputDate,
            lichDay: inputLichDay,
            giaTien: inputGiaTien,
        }).then((data) => {
            alert("Thành công")
            console.log(data); // JSON data parsed by `data.json()` call
        }));


    }
</script>

<script>
    const Search = document.querySelector(" .Search");
    var luuIdKh;

    // Example POST method implementation:
    async function Searchs(url = "") {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "GET", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            //body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }


    function SEARCH() {
        // Lấy tham chiếu đến phần tử input
        var inputName = document.getElementById("KH").value;
        var inputDate = document.getElementById("Date").value;
        var inputLichDay = document.getElementById("LichDay").value;
        var inputGiaTien = document.getElementById("GiaTien").value;

        let data = {
            tenKh: inputName,
            thoiGian: inputDate,
            lichDay: inputLichDay,
            giaTien: inputGiaTien,
            pageBegin: 0,
            pageEnd: 5,
        }
        let queryString = Object.keys(data).map(key => key + '=' + encodeURIComponent(data[key])).join('&');
        let urlWithQuery = 'http://localhost:8889/KhoaHoc/timKiem??' + queryString;

        Search.addEventListener('click', Searchs(urlWithQuery).then((data) => {
            const table = document.getElementById("table-container");
            const tbody = table.getElementsByTagName("tbody")[0];

            // Xóa các hàng hiện tại
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }

            // Thêm dữ liệu từ API vào bảng
            data.forEach(function (item) {
                const row = document.createElement("tr");
                const cell1 = document.createElement("td");
                const cell2 = document.createElement("td");
                const cell3 = document.createElement("td");
                const cell4 = document.createElement("td");
                const cell5 = document.createElement("td");
                const cell6 = document.createElement("td");
                const cell7 = document.createElement("td");


                const editButton = document.createElement("button");
                const deleteButton = document.createElement("button");

                cell1.textContent = item.stt;
                cell2.textContent = item.idKh;
                cell3.textContent = item.tenKh;
                cell4.textContent = item.thoiGian;
                cell5.textContent = item.lichDay;
                cell6.textContent = item.giaTien;

                editButton.textContent = "Sửa";
                deleteButton.textContent = "Xóa";

                row.appendChild(cell1);
                row.appendChild(cell2);
                row.appendChild(cell3);
                row.appendChild(cell4);
                row.appendChild(cell5);
                row.appendChild(cell6);
                row.appendChild(cell7);


                cell7.appendChild(editButton);
                cell7.appendChild(deleteButton);


                tbody.appendChild(row);

                // Gắn sự kiện click vào nút "Sửa"
                editButton.addEventListener("click", function () {
                    // Lấy dữ liệu từ hàng chứa nút "Sửa"
                    const rowData = Array.from(row.children).map(cell => cell.textContent);
                    luuIdKh = rowData[1];
                    const editTen = rowData[2];
                    const editThoiGian = rowData[3];
                    const editLichDay = rowData[4];
                    const editGiaTien = rowData[5];

                    const buyBtns = document.querySelectorAll('.js-buy-ticket')
                    const modal = document.querySelector('.js-modal')
                    const modalClose = document.querySelector('.js-modal-close')
                    const modalContainer = document.querySelector('.js-modal-container')

                    // Open modal
                    modal.classList.add('open')

                    function hideBuy() {
                        modal.classList.remove('open')
                    }

                    for (const buyBtn of buyBtns) {
                        buyBtn.addEventListener('click', showBuy)
                    }

                    modalClose.addEventListener('click', hideBuy)

                    modal.addEventListener('click', hideBuy)

                    modalContainer.addEventListener('click', function (event) {
                        event.stopPropagation()
                    })

                    // Lấy dữ liệu của các ô để cho vào modal Sửa
                    document.getElementById("updateIdKh").value = luuIdKh;
                    document.getElementById("updateTenKh").value = editTen;
                    document.getElementById("updateLichDay").value = editLichDay;
                    document.getElementById("updateThoiGian").value = editThoiGian;
                    document.getElementById("updateGiaTien").value = editGiaTien;


                    // Thực hiện các hành động khác với dữ liệu đã lấy được

                    // location.reload()
                });

                deleteButton.addEventListener("click", function () {
                    // Lấy dữ liệu từ hàng chứa nút "Xóa"
                    const rowData = Array.from(row.children).map(cell => cell.textContent);
                    luuIdKh = rowData[1];
                    async function Delete(url = "", data = {}) {
                        // Default options are marked with *
                        const response = await fetch(url, {
                            method: "DELETE", // *GET, POST, PUT, DELETE, etc.
                            mode: "cors", // no-cors, *cors, same-origin
                            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                            credentials: "same-origin", // include, *same-origin, omit
                            headers: {
                                "Content-Type": "application/json",
                                // 'Content-Type': 'application/x-www-form-urlencoded',
                            },
                            redirect: "follow", // manual, *follow, error
                            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                            body: JSON.stringify(data), // body data type must match "Content-Type" header
                        });
                        return response.json(); // parses JSON response into native JavaScript objects
                    }

                    Delete('http://localhost:8889/KhoaHoc/xoa', {
                        idKh: luuIdKh
                    }).then((res) => {
                        alert("Đã xóa thành công")
                        location.reload()
                    })

                });

            });
        }));
    }
</script>


<script>

    // Xử lý nút sửa ở Modal sửa

    const buttonSua = document.querySelector('.buttonEdit');

    async function Update(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "PUT", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }

    function hideModalSua() {
        modal.classList.remove('open')
    }

    function suaKhoaHoc() {

        var valueTenKh = document.getElementById("updateTenKh").value;
        var valueLichDay = document.getElementById("updateLichDay").value;
        var valueThoiGian = document.getElementById("updateThoiGian").value;
        var valueGiaTien = document.getElementById("updateGiaTien").value;

        buttonSua.addEventListener('click', Update('http://localhost:8889/KhoaHoc/capNhat', {
            idKh: luuIdKh,
            tenKh: valueTenKh,
            thoiGian: valueThoiGian,
            lichDay: valueLichDay,
            giaTien: valueGiaTien
        }).then((data) => {
            alert("Sửa thành công")
            hideModalSua()
            location.reload()
        }));
    }


</script>

</body>
</html>
