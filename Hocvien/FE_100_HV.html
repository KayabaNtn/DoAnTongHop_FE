<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Cats Sport Academy</title>
    <link href="./assets/css/FE_100_HV.css" rel="stylesheet">
    <link href="./assets/css/responsive.css" rel="stylesheet">
    <link href="./assets/fonts/themify-icons.css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
          integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
          referrerpolicy="no-referrer" rel="stylesheet"/>

</head>
<body>

<div id="main">

    <div id="header">
        <!-- Begin : nav -->
        <ul id="nav"> <!--ul#nav>li*5 -->
            <a><img alt="abc" class="logo" src="./assets/image/logo.jpg"></a>
            <li><a href="../Hocvien/FE_ALL.html">Trang chủ</a></li>
            <li><a href="../Hocvien/FE_100_HV.html">Thông tin Cá nhân</a></li>
            <li><a href="../Hocvien/FE_106_HV.html">FeedBack</a></li>

            <li><a href="#footer">Giới thiệu</a></li>
        </ul>
        <!-- End : nav -->
        <!-- Begin : search button -->
        <div class="search-btn">
            <i class="search-icon ti-search"></i>
        </div>
        <div class="search-btn1">
            <p class="fix" id="hocvien" style="padding-top: 10px"><br>
            </p>
        </div>
        <div class="search-btn1">
            <ul id="nav">
                <li><a href="../Hocvien/FE_ALL.html">Đăng xuất</a></li>
            </ul>
        </div>
        <!-- End : search button -->
    </div>

    <div id="bodys">
        <div class="form-student">

            <h3>Thông Tin Học Viên</h3>

            <label style="padding-top: 10px">ID học viên :</label>
            <input class="" disabled id="IDHV" placeholder="14444" tabindex="1" type="text">
            <br>

            <label style="padding-top: 10px">Tên học viên :</label>
            <input class="form_st_input" disabled id="tenHV" placeholder="Seng Phet" tabindex="2" type="text">
            <br>

            <label style="padding-top: 10px">Ngày sinh :</label>
            <input class="form_st_input" disabled id="Date" placeholder="05/09/1990" tabindex="3"
                   type="text">
            <br>

            <label style="padding-top: 10px">Địa chỉ :</label>
            <input class="form_st_input" disabled id="diaChi" placeholder="Giải phóng" tabindex="4" type="text">
            <br>

            <label id="lblGender" style="padding-top: 10px">Giới tính : </label>
            <input class="form_st_input" disabled id="gioiTinh" placeholder="" tabindex="5" type="text">
            <br>

            <label style="padding-top: 10px">Email :</label>
            <input class="form_st_input" disabled id="email" placeholder="*****@gmail.com" tabindex="6"
                   type="text">
            <br>

            <label style="padding-top: 10px">Số điện thoại :</label>
            <input class="form_st_input" disabled id="sdt" placeholder="0366******" tabindex="7" type="text">
            <br>

            <label style="padding-top: 10px">Điểm đánh giá</label>
            <input class="" disabled id="diemDanhGia" placeholder="" tabindex="8" type="text">
            <br>

            <label style="padding-top: 10px">Mật khẩu :</label>
            <input class="form_st_input" disabled id="matKhau" placeholder="05******" tabindex="8" type="text">
            <br>


            <label for="">&nbsp;</label>
            <button class="btn-save" onclick="enableInputs()">Sửa</button>
            <label for="">&nbsp;</label>
            <button class="btn-save buttonSua" onclick="disableInputs()">Hoàn Thành</button>


        </div>
    </div>


    <div id="footer">
        <div class="socials-list">
            <a href="#"><i class="ti-facebook"></i></a>
            <a href="#"><i class="ti-instagram"></i></a>
            <a href="#"><i class="ti-youtube"></i></a>
            <a href="#"><i class="ti-printerest"></i></a>
            <a href="#"><i class="ti-twitter"></i></a>
            <a href="#"><i class="ti-linkedin"></i></a>
        </div>
        <p class="copyright">
            Powered by <a href="#"> Cats Sport Academy
        </a>
        </p>
    </div>
</div>


<script>

    const test = localStorage.getItem('user');
    document.getElementById('hocvien').textContent = test;
    let luuDiemDanhGia, idHv;

    async function Searchs(url = "") {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "GET", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            //body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }

    let dataSearch = {
        email: test,
        pageBegin: 0,
        pageEnd: 1,
    }
    // let queryString = Object.keys(dataSearch).map(key => key + '=' + encodeURIComponent(dataSearch[key])).join('&');
    // let urlWithQuery = 'http://localhost:8889/NhanVien/search??' + queryString;

    let queryString = '';
    for (let key in dataSearch) {
        if (dataSearch.hasOwnProperty(key)) {
            queryString += key + '=' + encodeURIComponent(dataSearch[key]) + '&';
        }
    }
    queryString = queryString.slice(0, -1); // Loại bỏ ký tự & cuối cùng

    let urlWithQuery = 'http://localhost:8889/HocVien/search?' + queryString;


    // Tự động chay API lấy thông tin
    document.addEventListener("DOMContentLoaded", Searchs(urlWithQuery).then((res) => {
            idHv = res[0].idHv;
            luuDiemDanhGia = res[0].diemDanhGia;
            document.getElementById("tenHV").value = res[0].tenHv;
            document.getElementById("IDHV").value = res[0].idHv;
            document.getElementById("Date").value = res[0].ngaySinh;
            document.getElementById("sdt").value = res[0].sdt;
            document.getElementById("diaChi").value = res[0].diaChi;
            document.getElementById("matKhau").value = res[0].matKhau;
            document.getElementById("email").value = res[0].email;
            document.getElementById("gioiTinh").value = res[0].gioiTinh;
        })
    );
</script>

<script>
    const buttonSua = document.querySelector('.buttonSua')
    // Lưu phần tử input có thuộc tính disabled vào biến
    let myInputs = document.getElementsByClassName("form_st_input");

    // Bật thuộc tính disabled của phần tử input
    function enableInputs() {
        for (let i = 0; i < myInputs.length; i++) {
            myInputs[i].disabled = false;
        }
    }

    // Tắt thuộc tính disabled của phần tử input và chạy api update
    function disableInputs() {
        for (let i = 0; i < myInputs.length; i++) {
            myInputs[i].disabled = true;
        }

        async function Update(url = "", data = {}) {
            // Default options are marked with *
            const response = await fetch(url, {
                method: "PUT", // *GET, POST, PUT, DELETE, etc.
                mode: "cors", // no-cors, *cors, same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                credentials: "same-origin", // include, *same-origin, omit
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: "follow", // manual, *follow, error
                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: JSON.stringify(data), // body data type must match "Content-Type" header
            });
            return response.json(); // parses JSON response into native JavaScript objects
        }


        const edittenHV = document.getElementById("tenHV").value;
        const editDate = document.getElementById("Date").value;
        const editdiaChi = document.getElementById("diaChi").value;
        const editGioiTinh = document.getElementById("gioiTinh").value;
        const editemail = document.getElementById("email").value;
        const editsdt = document.getElementById("sdt").value;
        const editmatKhau = document.getElementById("matKhau").value;

        buttonSua.addEventListener('click', Update('http://localhost:8889/HocVien/update', {
            idHv: idHv,
            tenHv: edittenHV,
            ngaySinh: editDate,
            diaChi: editdiaChi,
            gioiTinh: editGioiTinh,
            email: editemail,
            sdt: editsdt,
            diemDanhGia: luuDiemDanhGia,
            matKhau: editmatKhau,
        }).then((data) => {
            alert("Sửa học viên thành công")
            location.reload()
        }));
    }


</script>


</body>
</html>
