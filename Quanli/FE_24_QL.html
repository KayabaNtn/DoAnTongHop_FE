<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Cats Sport AcademyThe Band</title>
    <link href="./assets/css/FE_24_QL.css" rel="stylesheet">
    <link href="./assets/css/responsive.css" rel="stylesheet">
    <link href="./assets/fonts/themify-icons.css" rel="stylesheet">
</head>
<body>

<div id="main">

    <div id="header">
        <!-- Begin : nav -->
        <ul id="nav"> <!--ul#nav>li*5 -->
            <img alt="abc" class="logo" src="./assets/image/logo.jpg">
            <li><a href="../Hocvien/FE_ALL.html">Trang chủ</a></li>
            <li><a href="./FE_24_QL.html">Học Viên </a></li>
            <li><a href="./FE_QLNV_QL.html">Nhân Viên </a></li>
            <li><a href="./FE_36_QL.html">Hợp Đồng </a></li>
            <li><a href="./FE_42_QL.html">Phiếu Đăng Kí </a></li>
            <li><a href="./FE_54_QL.html">Feed-Back </a></li>
            <li><a href="./FE_18_QL.html">Khóa Học </a></li>
            <li><a href="./FE_48_QL.html">Vật tư </a></li>
            <li><a href="./FE_ThongKe_QL.html">Thống Kê </a></li>
        </ul>
        <!-- End : nav -->
        <!-- Begin : search button -->
        <div class="search-btn">
            <i class="search-icon ti-search"></i>
        </div>
        <div class="search-btn1 fixQl">
            <p class="fix" id="quanly"><br>
            </p>
        </div>
        <div class="search-btn1">
            <ul id="nav">
                <li><a href="../Hocvien/FE_ALL.html">Đăng xuất</a></li>
            </ul>
        </div>
        <!-- End : search button -->
    </div>

    <div id="bodys">
        <div class="form-student">
            <h3>Thông tin Học viên</h3>

            <label>Họ và Tên:</label>
            <input id="txtFullName" tabindex="1" type="text">
            <br>

            <label>Ngày Sinh:</label>
            <input id="txtNgaySinh" tabindex="2" type="text">
            <br>

            <label>Quê quán:</label>
            <input id="txtHomeTown" tabindex="3" type="text">
            <br>

            <label id="lblGender">Giới tính:</label>
            <input id="male" name="gender" tabindex="4" type="radio" value="Nam "> Nam
            <input id="female" name="gender" tabindex="5" type="radio" value="Nữ "> Nữ
            <br>
            <br>

            <label>Địa chỉ Email:</label>
            <input id="txtEmailAddress" tabindex="6" type="text">
            <br>

            <label>Số điện thoại:</label>
            <input id="txtPhoneNumber" tabindex="7" type="text">
            <br>

            <label>Mật Khẩu :</label>
            <input id="txtPass" tabindex="8" type="text">
            <br>
            <label>&nbsp;</label>
            <button class=" btn-save js-save js-buy-ticket-them">Thêm</button>
            <label>&nbsp;</label>
            <button class=" btn-save search " onclick="getValue1()">Tìm Kiếm</button>


        </div>


    </div>
    <div class="list-student">
        <h3>Danh sách Học viên</h3>
        <!--        // Tạo table để gán ID-->
        <table id="table-container">
            <thead>
            <tr>
                <th>STT</th>
                <th>ID</th>
                <th>Tên</th>
                <th>Ngày sinh</th>
                <th>Địa chỉ</th>
                <th>Giới tính</th>
                <th>Email</th>
                <th>SDT</th>
                <th>Điểm</th>
                <th>Mật khẩu</th>
                <th>Thao tác</th>
            </tr>
            </thead>
            <tbody>
            <!-- Các hàng dữ liệu sẽ được thêm vào đây -->
            </tbody>
        </table>
    </div>

    <div id="footer">
        <div class="socials-list">
            <a href=""><i class="ti-facebook"></i></a>
            <a href=""><i class="ti-instagram"></i></a>
            <a href=""><i class="ti-youtube"></i></a>

            <a href=""><i class="ti-twitter"></i></a>
            <a href=""><i class="ti-linkedin"></i></a>
        </div>
        <p class="copyright">
            Powered by <a href="#"> Cats Sport Academy
        </a>
        </p>
    </div>
</div>


<!-- Modal sửa-->
<div class="modal js-modal">
    <div class="modal-container js-modal-container">
        <div class="modal-close js-modal-close ">
            <i class="ti-close"></i>
        </div>

        <header class="modal-header">
            <i class="modal-heading-icon ti-bag"></i>
            Sửa Đổi
        </header>

        <div class="modal-body">

            <div class="modal-body-left">

                <label class="modal-label" for="editTenHocVien">
                    <i class="ti-headphone-alt"></i>
                    Tên Học Viên :
                </label>
                <input class="modal-input" id="editTenHocVien" placeholder=" Tên Học Viên ?" type="text">

                <label class="modal-label" for="modal-Date">
                    <i class="ti-home"></i>
                    Ngày Sinh :
                </label>
                <input class="modal-input" id="editNgaySinh" placeholder="Ngày Sinh ?" type="text">

                <label class="modal-label" for="modal-DiaChi">
                    <i class="ti-user"></i>
                    Địa Chỉ :
                </label>
                <input class="modal-input" id="editDiaChi" placeholder=" Địa Chỉ ?" type="text">

                <label class="modal-label" for="modal-gioiTinh">
                    <i class="ti-user"></i>
                    Giới Tính :
                </label>
                <input class="modal-input" id="editGioiTinh" placeholder="  Giới Tính ?" type="text">

            </div>
            <div class="modal-body-right">
                <label class="modal-label" for="modal-Email">
                    <i class="ti-user"></i>
                    Email :
                </label>
                <input class="modal-input" id="editEmail" placeholder="  Email  ?" type="text">

                <label class="modal-label" for="modal-sdt">
                    <i class="ti-user"></i>
                    Số Điện Thoại :
                </label>
                <input class="modal-input" id="editSoDienThoai" placeholder=" Số Điện Thoại ?" type="text">

                <label class="modal-label" for="modal-feedback">
                    <i class="ti-user"></i>
                    Điểm đánh giá :
                </label>
                <input class="modal-input" disabled id="editDiemDanhGia" placeholder=" Điểm đánh giá ?" type="text">

                <label class="modal-label" for="modal-matKhau">
                    <i class="ti-user"></i>
                    Mật khẩu :
                </label>
                <input class="modal-input" id="editMatKhau" placeholder=" Mật khẩu ?" type="text">

            </div>
            <button class="buttonEdit" id="buy-tickets" onclick="suaHocVien()">
                Sửa <i class="ti-check"></i>
            </button>

        </div>

        <footer class="modal-footer">
            <p class="modal-help">Need <a href="#">helf?</a></p>
        </footer>
    </div>
</div>


<!--// Modal thêm-->
<div class="modal js-modal-them">
    <div class="modal-container js-modal-container-them">
        <div class="modal-close js-modal-close-them ">
            <i class="ti-close"></i>
        </div>

        <header class="modal-header">
            <i class="modal-heading-icon ti-bag"></i>
            Thêm
        </header>

        <div class="modal-body">

            <div class="modal-body-left">

                <label class="modal-label" for="addTenHv">
                    <i class="ti-headphone-alt"></i>
                    Tên Học Viên :
                </label>
                <input class="modal-input" id="addTenHv" placeholder=" Tên Học Viên ?" type="text">

                <label class="modal-label" for="addNgaySinh">
                    <i class="ti-home"></i>
                    Ngày Sinh :
                </label>
                <input class="modal-input" id="addNgaySinh" placeholder="Ngày Sinh ?" type="text">

                <label class="modal-label" for="addDiaChi">
                    <i class="ti-user"></i>
                    Địa Chỉ :
                </label>
                <input class="modal-input" id="addDiaChi" placeholder=" Địa Chỉ ?" type="text">

                <label class="modal-label" for="addGioiTinh">
                    <i class="ti-user"></i>
                    Giới Tính :
                </label>
                <input class="modal-input" id="addGioiTinh" placeholder="  Giới Tính ?" type="text">

            </div>
            <div class="modal-body-right">
                <label class="modal-label" for="addEmail">
                    <i class="ti-user"></i>
                    Email :
                </label>
                <input class="modal-input" id="addEmail" placeholder="  Email  ?" type="text">

                <label class="modal-label" for="addSDT">
                    <i class="ti-user"></i>
                    Số Điện Thoại :
                </label>
                <input class="modal-input" id="addSDT" placeholder=" Số Điện Thoại ?" type="text">

                <label class="modal-label" for="addDiemDanhGia">
                    <i class="ti-user"></i>
                    Điểm đánh giá :
                </label>
                <input class="modal-input" id="addDiemDanhGia" placeholder=" Điểm đánh giá ?" type="text">

                <label class="modal-label" for="addMatKhau">
                    <i class="ti-user"></i>
                    Mật khẩu :
                </label>
                <input class="modal-input" id="addMatKhau" placeholder=" Mật khẩu ?" type="text">

            </div>
            <button class="addHocVien JShideModalThem" id="buy-tickets" onclick="addHocVien()">
                Thêm <i class="ti-check"></i>
            </button>

        </div>

        <footer class="modal-footer">
            <p class="modal-help">Need <a href="#">helf?</a></p>
        </footer>
    </div>
</div>

<script>
    const test = localStorage.getItem('user');
    document.getElementById('quanly').textContent = test;
    const Them = document.querySelectorAll('.js-buy-ticket-them')
    const modal1 = document.querySelector('.js-modal-them')
    const modalClose1 = document.querySelector('.js-modal-close-them')
    const modalContainer1 = document.querySelector('.js-modal-container-them')


    function showBuy() {
        modal1.classList.add('open')
    }

    function hideBuy() {
        modal1.classList.remove('open')
    }

    for (const buyBtn of Them) {
        buyBtn.addEventListener('click', showBuy)
    }

    modalClose1.addEventListener('click', hideBuy)

    modal1.addEventListener('click', hideBuy)

    modalContainer1.addEventListener('click', function (event) {
        event.stopPropagation()
    })
</script>

<script>
    const buyBtns = document.querySelectorAll('.js-buy-ticket')
    const modal = document.querySelector('.js-modal')
    const modalClose = document.querySelector('.js-modal-close')
    const modalContainer = document.querySelector('.js-modal-container')


    function showBuy() {
        modal.classList.add('open')
    }

    function hideBuy() {
        modal.classList.remove('open')
    }

    for (const buyBtn of buyBtns) {
        buyBtn.addEventListener('click', showBuy)
    }

    modalClose.addEventListener('click', hideBuy)

    modal.addEventListener('click', hideBuy)

    modalContainer.addEventListener('click', function (event) {
        event.stopPropagation()
    })
</script>
<script>
    const Save = document.querySelector(" .addHocVien");
    const Search = document.querySelector(" .search");
    var luuIDHv;

    function showModelThem() {
        modal1.classList.add('open')
    }

    function hideModalThem1() {
        modal1.classList.remove('open')
    }

    // Example POST method implementation:
    async function Saves(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "POST", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }


    function addHocVien() {
        // Lấy tham chiếu đến phần tử input
        var inputName = document.getElementById("addTenHv").value;
        var inputDate = document.getElementById("addNgaySinh").value;
        var inputDiachi = document.getElementById("addDiaChi").value;
        var inputGioiTinh = document.getElementById("addGioiTinh").value;
        var inputEmail = document.getElementById("addEmail").value;
        var inputSDT = document.getElementById("addSDT").value;
        var inputDiemDanhGia = document.getElementById("addDiemDanhGia").value;
        var inputMatKhau = document.getElementById("addMatKhau").value;
        var radios = document.getElementsByName('gender');
        var selectedGender;
        for (var i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
                selectedGender = radios[i].value;
                break;
            }
        }
        // Nhật test thành công chức năng thêm rồi
        Save.addEventListener('click', Saves("http://localhost:8889/HocVien/insert", {
            tenHv: inputName,
            ngaySinh: inputDate,
            diaChi: inputDiachi,
            gioiTinh: inputGioiTinh,
            email: inputEmail,
            sdt: inputSDT,
            matKhau: inputMatKhau,

        }).then((data) => {
            alert("Thêm học viên thành công")
            hideModalThem1()
            location.reload()
        }));


    }


    // Example POST method implementation:
    async function Searchs(url = "") {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "GET", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            //body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }


    ////      Lấy dữ liệu search
    function getValue1() {
        // Lấy tham chiếu đến phần tử input
        var inputName = document.getElementById("txtFullName").value;
        var inputNgaySinh = document.getElementById("txtNgaySinh").value;
        var inputQuequan = document.getElementById("txtHomeTown").value;
        var inputEmail = document.getElementById("txtEmailAddress").value;
        var inputPhoneNB = document.getElementById("txtPhoneNumber").value;

        // Tạo bảng table tên đéo gì cũng được
        const table = document.createElement('tableTest');


        let data = {
            tenHv: inputName,
            ngaySinh: inputNgaySinh,
            pageBegin: 0,
            pageEnd: 5,
            diaChi: inputQuequan,
            email: inputEmail,
            sdt: inputPhoneNB

        }

        // let queryString = Object.keys(dataSearch).map(key => key + '=' + encodeURIComponent(dataSearch[key])).join('&');
        // let urlWithQuery = 'http://localhost:8889/NhanVien/search??' + queryString;

        let queryString = '';
        for (let key in data) {
            if (data.hasOwnProperty(key)) {
                queryString += key + '=' + encodeURIComponent(data[key]) + '&';
            }
        }
        queryString = queryString.slice(0, -1); // Loại bỏ ký tự & cuối cùng

        let urlWithQuery = 'http://localhost:8889/HocVien/search?' + queryString;


        Search.addEventListener('click', Searchs(urlWithQuery).then((data) => {

                // // Xử lý phần đổ dữ liệu
                // //////////////////////////////////////////////////////////////////////////////
                //
                // // Tạo bảng table tên đéo gì cũng được
                // const table = document.createElement('tableTest');
                //
                // // Tạo hàng tiêu đề
                // const headerRow = document.createElement('tr');
                // const headers = ['STT','Tên học viên','Ngày sinh', 'Địa chỉ', 'Giới tính', 'Email', 'Số điện thoại', 'Điểm đánh giá', 'Mật khẩu'];
                // headers.forEach(headerText => {
                //     const header = document.createElement('th');
                //     header.textContent = headerText;
                //     headerRow.appendChild(header);
                // });
                // table.appendChild(headerRow);
                //
                // // Điền dữ liệu vào các hàng
                // data.forEach(item => {
                //     const row = document.createElement('tr');
                //
                //     // Tạo cột cho tiêu đề STT
                //     const stt = document.createElement('td');
                //     stt.textContent = item.stt;
                //     row.appendChild(stt);
                //
                //     // Tạo cột cho tiêu đề Họ tên
                //     const hoten = document.createElement('td');
                //     hoten.textContent = item.tenHv;
                //     row.appendChild(hoten);
                //
                //
                //     // const ageCell = document.createElement('td');
                //     // ageCell.textContent = item.age;
                //     // row.appendChild(ageCell);
                //     //
                //     // const addressCell = document.createElement('td');
                //     // addressCell.textContent = item.address;
                //     // row.appendChild(addressCell);
                //
                //     table.appendChild(row);
                // });
                //
                // // Thêm bảng vào một phần tử HTML có sẵn trong trang
                // const tableContainer = document.getElementById('table-container');
                // tableContainer.appendChild(table);

                // Cách 2:
                const table = document.getElementById("table-container");
                const tbody = table.getElementsByTagName("tbody")[0];

                // Xóa các hàng hiện tại
                while (tbody.firstChild) {
                    tbody.removeChild(tbody.firstChild);
                }

                // Thêm dữ liệu từ API vào bảng
                data.forEach(function (item) {
                    const row = document.createElement("tr");
                    const cell1 = document.createElement("td");
                    const cell2 = document.createElement("td");
                    const cell3 = document.createElement("td");
                    const cell4 = document.createElement("td");
                    const cell5 = document.createElement("td");
                    const cell6 = document.createElement("td");
                    const cell7 = document.createElement("td");
                    const cell8 = document.createElement("td");
                    const cell9 = document.createElement("td");
                    const cell10 = document.createElement("td");
                    const cell11 = document.createElement("td");

                    const editButton = document.createElement("button");
                    const deleteButton = document.createElement("button");

                    cell1.textContent = item.stt;
                    cell2.textContent = item.idHv;
                    cell3.textContent = item.tenHv;
                    cell4.textContent = item.ngaySinh;
                    cell5.textContent = item.diaChi;
                    cell6.textContent = item.gioiTinh;
                    cell7.textContent = item.email;
                    cell8.textContent = item.sdt;
                    cell9.textContent = item.diemDanhGia;
                    cell10.textContent = item.matKhau;
                    editButton.textContent = "Sửa";
                    deleteButton.textContent = "Xóa";

                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    row.appendChild(cell3);
                    row.appendChild(cell4);
                    row.appendChild(cell5);
                    row.appendChild(cell6);
                    row.appendChild(cell7);
                    row.appendChild(cell8);
                    row.appendChild(cell9);
                    row.appendChild(cell10);
                    row.appendChild(cell11);

                    cell11.appendChild(editButton);
                    cell11.appendChild(deleteButton);


                    tbody.appendChild(row);

                    // Gắn sự kiện click vào nút "Sửa"
                    editButton.addEventListener("click", function () {
                        // Lấy dữ liệu từ hàng chứa nút "Sửa"
                        const rowData = Array.from(row.children).map(cell => cell.textContent);
                        luuIDHv = rowData[1];
                        const editTen = rowData[2];
                        const editNgaySinh = rowData[3];
                        const editDiaChi = rowData[4];
                        const editGioiTinh = rowData[5];
                        const editEmail = rowData[6];
                        const editSDT = rowData[7];
                        const editDiem = rowData[8];
                        const editMatKhau = rowData[9];

                        const buyBtns = document.querySelectorAll('.js-buy-ticket')
                        const modal = document.querySelector('.js-modal')
                        const modalClose = document.querySelector('.js-modal-close')
                        const modalContainer = document.querySelector('.js-modal-container')

                        // Open modal
                        modal.classList.add('open')

                        function hideBuy() {
                            modal.classList.remove('open')
                        }

                        for (const buyBtn of buyBtns) {
                            buyBtn.addEventListener('click', showBuy)
                        }

                        modalClose.addEventListener('click', hideBuy)

                        modal.addEventListener('click', hideBuy)

                        modalContainer.addEventListener('click', function (event) {
                            event.stopPropagation()
                        })

                        // Lấy dữ liệu của các ô để cho vào modal Sửa
                        document.getElementById("editTenHocVien").value = editTen;
                        document.getElementById("editEmail").value = editEmail;
                        document.getElementById("editDiaChi").value = editDiaChi;
                        document.getElementById("editGioiTinh").value = editGioiTinh;
                        document.getElementById("editMatKhau").value = editMatKhau;
                        document.getElementById("editDiemDanhGia").value = editDiem;
                        document.getElementById("editNgaySinh").value = editNgaySinh;
                        document.getElementById("editSoDienThoai").value = editSDT;


                        // Thực hiện các hành động khác với dữ liệu đã lấy được

                        // location.reload()
                    });

                    deleteButton.addEventListener("click", function () {
                        // Lấy dữ liệu từ hàng chứa nút "Xóa"
                        const rowData = Array.from(row.children).map(cell => cell.textContent);
                        luuIDHv = rowData[1];

                        async function Delete(url = "", data = {}) {
                            // Default options are marked with *
                            const response = await fetch(url, {
                                method: "DELETE", // *GET, POST, PUT, DELETE, etc.
                                mode: "cors", // no-cors, *cors, same-origin
                                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                                credentials: "same-origin", // include, *same-origin, omit
                                headers: {
                                    "Content-Type": "application/json",
                                    // 'Content-Type': 'application/x-www-form-urlencoded',
                                },
                                redirect: "follow", // manual, *follow, error
                                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                                body: JSON.stringify(data), // body data type must match "Content-Type" header
                            });
                            return response.json(); // parses JSON response into native JavaScript objects
                        }

                        Delete('http://localhost:8889/HocVien/delete', {
                            idHv: luuIDHv
                        }).then((res) => {
                            alert("Đã xóa thành công")
                            location.reload()
                        })

                        // location.reload()
                    });

                });
            })
        );
    }


</script>

<script>

    // Xử lý nút sửa ở Modal sửa

    const buttonSua = document.querySelector('.buttonEdit');

    async function Update(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "PUT", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }

    function hideModalSua() {
        modal.classList.remove('open')
    }

    function suaHocVien() {
        const editTenHv1 = document.getElementById("editTenHocVien").value;
        const editEmail1 = document.getElementById("editEmail").value;
        const editDiaChi1 = document.getElementById("editDiaChi").value;
        const editGioiTinh1 = document.getElementById("editGioiTinh").value;
        const editMatKhau1 = document.getElementById("editMatKhau").value;
        const editDiemDanhGia1 = document.getElementById("editDiemDanhGia").value;
        const editNgaySinh1 = document.getElementById("editNgaySinh").value;
        const editSDT1 = document.getElementById("editSoDienThoai").value;
        buttonSua.addEventListener('click', Update('http://localhost:8889/HocVien/update', {
            idHv: luuIDHv,
            tenHv: editTenHv1,
            ngaySinh: editNgaySinh1,
            diaChi: editDiaChi1,
            gioiTinh: editGioiTinh1,
            email: editEmail1,
            sdt: editSDT1,
            matKhau: editMatKhau1
        }).then((data) => {
            alert("Sửa học viên thành công")
            hideModalSua()
            location.reload()

        }));
    }


</script>
</body>
</html>
