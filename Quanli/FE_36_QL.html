<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Cats Sport Academy</title>
    <link href="./assets/css/FE_36_QL.css" rel="stylesheet">
    <link href="./assets/css/responsive.css" rel="stylesheet">
    <link href="./assets/fonts/themify-icons.css" rel="stylesheet">
</head>
<body>

<div id="main">

    <div id="header">
        <!-- Begin : nav -->
        <ul id="nav"> <!--ul#nav>li*5 -->
            <img alt="abc" class="logo" src="./assets/image/logo.jpg">
            <li><a href="../Hocvien/FE_ALL.html">Trang chủ</a></li>
            <li><a href="./FE_24_QL.html">Học Viên </a></li>
            <li><a href="./FE_36_QL.html">Hợp Đồng </a></li>
            <li><a href="./FE_42_QL.html">Phiếu Đăng Kí </a></li>
            <li><a href="./FE_54_QL.html">Feed-Back </a></li>
            <li><a href="./FE_18_QL.html">Khóa Học </a></li>
            <li><a href="./FE_48_QL.html">Vật tư </a></li>
            <li><a href="#footer">Giới thiệu</a></li>
        </ul>
        <!-- End : nav -->
        <!-- Begin : search button -->
        <div class="search-btn">
            <i class="search-icon ti-search"></i>
        </div>
        <div class="search-btn1">
            <p class="fix">Mai Hồng Quân <br>
                Quản lí </p>
        </div>
        <!-- End : search button -->
    </div>

    <div id="bodys">
        <div class="form-student">
            <h3>Thông tin Hợp đồng</h3>

            <label>ID Khách Hàng :</label>
            <input id="txtKhachHang" tabindex="1" type="text">
            <br>

            <label>Lớp Học :</label>
            <input id="txtLopHoc" tabindex="2" type="text">
            <br>

            <label>ID Học Viên:</label>
            <input id="txtHocVien" tabindex="3" type="text">
            <br>

            <label>Ngày Kí :</label>
            <input id="txtDate" tabindex="4" type="text">
            <br>

            <label>Học Phí :</label>
            <input id="txtHocPhi" tabindex="5" type="text">
            <br>

            <label>&nbsp;</label>
            <button class="btn-save Search" onclick="SEARCH()">Tìm</button>
            <label>&nbsp;</label>
            <button class="btn-save js-HD-themOpen  ">Thêm</button>
            <!--            <label >&nbsp;</label>-->
            <!--            <button class="btn-save js-buy-ticket-sua  " >Sửa</button>-->
        </div>


    </div>

    <div class="list-student">
        <h3>Danh sách Hợp đồng</h3>
        <!--        // Tạo table để gán ID-->
        <table id="tableHopDong">
            <thead>
            <tr>
                <th>STT</th>
                <th>ID hợp đồng</th>
                <th>Tên nhân viên</th>
                <th>Tên học viên</th>
                <th>Tên lớp học</th>
                <th>Tên khóa học</th>
                <th>Ngày ký hợp đồng</th>
                <th>Thao tác</th>
            </tr>
            </thead>
            <tbody>
            <!-- Các hàng dữ liệu sẽ được thêm vào đây -->
            </tbody>
        </table>
    </div>


    <div id="footer">
        <div class="socials-list">
            <a href=""><i class="ti-facebook"></i></a>
            <a href=""><i class="ti-instagram"></i></a>
            <a href=""><i class="ti-youtube"></i></a>
            <a href=""><i class="ti-printerest"></i></a>
            <a href=""><i class="ti-twitter"></i></a>
            <a href=""><i class="ti-linkedin"></i></a>
        </div>
        <p class="copyright">
            Powered by <a href="#"> Cats Sport Academy
        </a>
        </p>
    </div>
</div>
<!--  MODAL SỬA -->
<div class="modal js-modal-them">
    <div class="modal-container js-modal-container-them">
        <div class="modal-close js-modal-close-them ">
            <i class="ti-close"></i>
        </div>

        <header class="modal-header">
            <i class="modal-heading-icon ti-bag"></i>
            Sửa
        </header>

        <div class="modal-body">

            <label class="modal-label" for="updateIdKh">
                <i class="ti-user"></i>
                ID Khách Hàng:
            </label>
            <input class="modal-input" id="updateIdKh" placeholder="ID Khách Hàng ?" type="text">


            <label class="modal-label" for="updateIdLh">
                <i class="ti-email"></i>
                ID Lớp học:
            </label>
            <input class="modal-input" id="updateIdLh" placeholder="ID Lớp học ?" type="text">

            <label class="modal-label" for="updateIdHv">
                <i class="ti-headphone-alt"></i>
                ID Học Viên :
            </label>
            <input class="modal-input" id="updateIdHv" placeholder="ID Học Viên  ?" type="text">

            <label class="modal-label" for="updateIdNv">
                <i class="ti-headphone-alt"></i>
                ID Nhân Viên :
            </label>
            <input class="modal-input" id="updateIdNv" placeholder="ID Nhân Viên  ?" type="text">

            <label class="modal-label" for="updateHocPhi">
                <i class="ti-home"></i>
                Học Phí :
            </label>
            <input class="modal-input" id="updateHocPhi" placeholder="Học Phí ?" type="number">

            <label class="modal-label" for="updateNgayKy">
                <i class="ti-alarm-clock"></i>
                Date :
            </label>
            <input class="modal-input" id="updateNgayKy" placeholder="Ngày ?" type="text">

            <button class="" id="buy-tickets">
                Sửa <i class="ti-check"></i>
            </button>

        </div>

        <footer class="modal-footer">
            <p class="modal-help">Need <a href="#">helf?</a></p>
        </footer>
    </div>
</div>


<div class="modal js-modal">
    <div class="modal-container js-modal-container">
        <div class="modal-close js-modal-close ">
            <i class="ti-close"></i>
        </div>

        <header class="modal-header">
            <i class="modal-heading-icon ti-bag"></i>
            Thêm
        </header>

        <div class="modal-body">

            <label class="modal-label" for="ID-KH">
                <i class="ti-user"></i>
                ID Khách Hàng:
            </label>
            <input class="modal-input" id="ID-KH" placeholder="ID Khách Hàng ?" type="text">


            <label class="modal-label" for="ID-LH">
                <i class="ti-email"></i>
                ID Lớp học:
            </label>
            <input class="modal-input" id="ID-LH" placeholder="ID Lớp học ?" type="text">

            <label class="modal-label" for="ID-HV">
                <i class="ti-headphone-alt"></i>
                ID Học Viên :
            </label>
            <input class="modal-input" id="ID-HV" placeholder="ID Học Viên  ?" type="text">

            <label class="modal-label" for="ID-NV">
                <i class="ti-headphone-alt"></i>
                ID Nhân Viên :
            </label>
            <input class="modal-input" id="ID-NV" placeholder="ID Nhân Viên  ?" type="text">

            <label class="modal-label" for="hocPhi">
                <i class="ti-home"></i>
                Học Phí :
            </label>
            <input class="modal-input" id="hocPhi" placeholder="Học Phí ?" type="number">

            <label class="modal-label" for="ngayKy">
                <i class="ti-alarm-clock"></i>
                Date :
            </label>
            <input class="modal-input" id="ngayKy" placeholder="Ngày ?" type="text">


            <button class="abc" id="buy-tickets" onclick="getValue()">
                Hoàn thành <i class="ti-check"></i>
            </button>

        </div>

        <footer class="modal-footer">
            <p class="modal-help">Need <a href="#">helf?</a></p>
        </footer>
    </div>
</div>

<script>
    const buyBtns = document.querySelectorAll('.js-HD-themOpen')
    const modal = document.querySelector('.js-modal')
    const modalClose = document.querySelector('.js-modal-close')
    const modalContainer = document.querySelector('.js-modal-container')
    const add = document.querySelector('.abc')

    function showBuy() {
        modal.classList.add('open')
    }

    function hideBuy() {
        modal.classList.remove('open')
    }

    for (const buyBtn of buyBtns) {
        buyBtn.addEventListener('click', showBuy)
    }

    modalClose.addEventListener('click', hideBuy)

    modal.addEventListener('click', hideBuy)

    modalContainer.addEventListener('click', function (event) {
        event.stopPropagation()
    })

    async function ADDS(url = "", data = {}) {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "POST", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }

    function getValue() {
        // Lấy tham chiếu đến phần tử input
        var inputIDKH = document.getElementById("ID-KH").value;
        var inputIDLH = document.getElementById("ID-LH").value;
        var inputIDHV = document.getElementById('ID-HV').value;
        var inputIDNV = document.getElementById("ID-NV").value;
        var inputhocPhi = document.getElementById("hocPhi").value;
        var inputngayKy = document.getElementById("ngayKy").value;
        console.log(add)
        add.addEventListener('click', ADDS("http://localhost:8889/HopDong/insert", {
            idKh: inputIDKH,
            idLh: inputIDLH,
            idHv: inputIDHV,
            idNv: inputIDNV,
            ngayKy: inputngayKy,
            hocPhi: inputhocPhi,

        }).then((data) => {
            alert("Thành công")
            hideBuy()
        }));

    }

    const Search = document.querySelector(" .Search");


    // Example POST method implementation:
    async function Searchs(url = "") {
        // Default options are marked with *
        const response = await fetch(url, {
            method: "GET", // *GET, POST, PUT, DELETE, etc.
            mode: "cors", // no-cors, *cors, same-origin
            cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
            credentials: "same-origin", // include, *same-origin, omit
            headers: {
                "Content-Type": "application/json",
                // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            redirect: "follow", // manual, *follow, error
            referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            //body: JSON.stringify(data), // body data type must match "Content-Type" header
        });
        return response.json(); // parses JSON response into native JavaScript objects
    }


    function SEARCH() {

        const Them = document.querySelectorAll('.js-buy-ticket-sua')
        const modal1 = document.querySelector('.js-modal-them')
        const modalClose1 = document.querySelector('.js-modal-close-them')
        const modalContainer1 = document.querySelector('.js-modal-container-them')

        var luuIdHd;


        function showModalSua() {
            modal1.classList.add('open')
        }

        function hideModalSua() {
            modal1.classList.remove('open')
        }

        for (const buyBtn of Them) {
            buyBtn.addEventListener('click', showModalSua)
        }

        modalClose1.addEventListener('click', hideModalSua)

        modal1.addEventListener('click', hideModalSua)

        modalContainer1.addEventListener('click', function (event) {
            event.stopPropagation()
        })

        // Lấy tham chiếu đến phần tử input
        var inputKhachHang = document.getElementById("txtKhachHang").value;
        var inputLopHoc = document.getElementById("txtLopHoc").value;
        var inputHocVien = document.getElementById("txtHocVien").value;
        var inputDate = document.getElementById("txtDate").value;
        var inputHocPhi = document.getElementById("txtHocPhi").value;


        let data = {
            idKh: inputKhachHang,
            idLh: inputLopHoc,
            idHv: inputHocVien,
            pageBegin: 0,
            pageEnd: 5,
            ngayKy: inputDate,
            hocPhi: inputHocPhi
        }
        let queryString = Object.keys(data).map(key => key + '=' + encodeURIComponent(data[key])).join('&');
        let urlWithQuery = 'http://localhost:8889/HopDong/search??' + queryString;
        Search.addEventListener('click', Searchs(urlWithQuery).then((data) => {
                const table = document.getElementById("tableHopDong");
                const tbody = table.getElementsByTagName("tbody")[0];

                // Xóa các hàng hiện tại
                while (tbody.firstChild) {
                    tbody.removeChild(tbody.firstChild);
                }

                // Thêm dữ liệu từ API vào bảng
                data.forEach(function (item) {
                    const row = document.createElement("tr");
                    const cell1 = document.createElement("td");
                    const cell2 = document.createElement("td");
                    const cell3 = document.createElement("td");
                    const cell4 = document.createElement("td");
                    const cell5 = document.createElement("td");
                    const cell6 = document.createElement("td");
                    const cell7 = document.createElement("td");
                    const cell8 = document.createElement("td");


                    const editButton = document.createElement("button");
                    const deleteButton = document.createElement("button");

                    cell1.textContent = item.stt;
                    cell2.textContent = item.idHd;
                    cell3.textContent = item.tenNv;
                    cell4.textContent = item.tenHv;
                    cell5.textContent = item.tenLh;
                    cell6.textContent = item.tenKh;
                    cell7.textContent = item.ngayKy;

                    // editButton.textContent = "Sửa";
                    deleteButton.textContent = "Xóa";

                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    row.appendChild(cell3);
                    row.appendChild(cell4);
                    row.appendChild(cell5);
                    row.appendChild(cell6);
                    row.appendChild(cell7);
                    row.appendChild(cell8);

                    // cell8.appendChild(editButton);
                    cell8.appendChild(deleteButton);


                    tbody.appendChild(row);

                    // Gắn sự kiện click vào nút "Sửa"
                    // editButton.addEventListener("click", function () {
                    //     // Lấy dữ liệu từ hàng chứa nút "Sửa"
                    //     const rowData = Array.from(row.children).map(cell => cell.textContent);
                    //     luuIdHd = rowData[1];
                    //     const editTen = rowData[2];
                    //     const editNgaySinh = rowData[3];
                    //     const editDiaChi = rowData[4];
                    //     const editGioiTinh = rowData[5];
                    //     const editEmail = rowData[6];
                    //     const editSDT = rowData[7];
                    //     const editDiem = rowData[8];
                    //     const editMatKhau = rowData[9];
                    //
                    //
                    //     // Open modal
                    //     showModalSua()
                    //
                    //     // Lấy dữ liệu của các ô để cho vào modal Sửa
                    //     document.getElementById("editTenHocVien").value = editTen;
                    //     document.getElementById("editEmail").value = editEmail;
                    //     document.getElementById("editDiaChi").value = editDiaChi;
                    //     document.getElementById("editGioiTinh").value = editGioiTinh;
                    //     document.getElementById("editMatKhau").value = editMatKhau;
                    //     document.getElementById("editDiemDanhGia").value = editDiem;
                    //     document.getElementById("editNgaySinh").value = editNgaySinh;
                    //     document.getElementById("editSoDienThoai").value = editSDT;


                    // Thực hiện các hành động khác với dữ liệu đã lấy được

                    // location.reload()
                    // });

                    deleteButton.addEventListener("click", function () {
                        // Lấy dữ liệu từ hàng chứa nút "Xóa"
                        const rowData = Array.from(row.children).map(cell => cell.textContent);
                        luuIdHd = rowData[1];

                        async function Delete(url = "", data = {}) {
                            // Default options are marked with *
                            const response = await fetch(url, {
                                method: "DELETE", // *GET, POST, PUT, DELETE, etc.
                                mode: "cors", // no-cors, *cors, same-origin
                                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                                credentials: "same-origin", // include, *same-origin, omit
                                headers: {
                                    "Content-Type": "application/json",
                                    // 'Content-Type': 'application/x-www-form-urlencoded',
                                },
                                redirect: "follow", // manual, *follow, error
                                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                                body: JSON.stringify(data), // body data type must match "Content-Type" header
                            });
                            return response.json(); // parses JSON response into native JavaScript objects
                        }

                        Delete('http://localhost:8889/HopDong/delete', {
                            idHd: luuIdHd
                        }).then((res) => {
                            alert("Đã xóa thành công")
                            location.reload()
                        })

                        // location.reload()
                    });

                });
            })
        );

    }


</script>
</body>
</html>
